# `$compile`编译器

编译器`$compile`是一个`AngularJS`的内置服务，它负责遍历`DOM`树来查找匹配指令， 并调用指令的实现代码进行处理。

`HTML`编译包括3个步骤：

* **匹配指令**  
>`$compile`遍历`DOM`树，如果发现有元素匹配了某个指令，那么这个指令将被加入该`DOM`元素的指令列表中。一个`DOM`元素可能匹配多个指令。
* **执行指令的编译函数**
>当一个`DOM`元素的所有指令都找齐后，编译器根据指令的优先级/`priority`指令进行排序。每个指令的`compile`函数被依次执行。每个`compile`执行的结果产生一个`link`函数，这些`link`函数合并成一个复合`link`函数。

* **执行生成的链接函数**
>`$compile`通过执行指令的`link`函数，将模板和`scope`链接起来。结果就是一个`DOM`视图和`scope`对象模型之间的动态数据绑定。



<br>
**为何将编译和连接两个步骤分开?**

>简单说，当数据模型的变化会导致`DOM`结构变化时，指令就需要分别定义`compile()`函数和link函数。例如，`ng-repeat`指令需要为数据集合中的每个成员复制`DOM`元素。将编译和链接过程分开可以有效 地提高性能，因为`DOM`的复制放在`compile()`里，仅需要执行一次，但链接则发生在每个生成的`DOM`元素上，所以指令的`link()`函数会执行多次。  
指令很少需要`compile`函数，因为大多数指令考虑的是作用于特定的DOM元素实例，而不是改变`DOM `的结构。所以`link`函数更常用。



<Br>
`Link` [视图工作原理--编译阶段](/JavaScript模块/JavaScript框架/AngularJS学习/视图.md)

<br>
#####**阅读**
- [AngularJS进阶](http://www.hubwiz.com/class/54f3ba65e564e50cfccbad4b)