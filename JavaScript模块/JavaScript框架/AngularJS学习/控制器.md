# 控制器
#####**控制器的理解**
在`AngularJS`中，控制器是一个函数，与`JavaScript`中的构造函数一般，用来增强作用域。

当一个控制器通过`ng-controller`指令被添加到`DOM`中时，`ng`会调用该控制器的构造函数来生成一个控制器对象，并创建传递作用域`scope`进来（作用域`$scope`在构造函数中，以参数的形式注入）。由于`AngularJS`会负责处理控制器的实例化过程，我们只需编写构造函数即可。

`AngularJS`(`MVVM`)与其它基于`MVC`的`JavaScript`框架最主要的一个区别是，控制器不适合用来执行`DOM`操作、格式化或数据操作，以及除存储数据模型之外的状态维护操作。  
一般情况下，我们使用控制器做两件事：
* 初始化`$scope`对象
* 为`$scope`对象添加行为（方法）


<br> 
#####**创建控制器**

创建应用程序时，通常需要为`$scope`对象设置初始状态，通过在`$scope`对象上设置属性或方法实现。这些属性或方法就是提供在视图中展示用的视图模型(`view model`)。视图模型在与此控制器相关的模板中都可以访问到。

```
function FirstController($scope) {
 $scope.message = "hello";
}
```
将该控制器关联到DOM节点上，模板就可以通过数据绑定来读取数据模型：
```
 <div ng-controller="FirstController">
      
 </div>
```
上面在全局作用域中创建了控制器。一般情况下不建议这么做，它污染了全局命名空间。在实际的应用程序中，一般在模块中通过`.controller`来创建一个控制器。

```
var app = angular.module('app', []);
app.controller('FirstController', function($scope) {
 $scope.message = "hello";
});
```
<br>
######**为`$scope`添加行为**
为了对事件做出响应，或在视图中执行计算，需要为`scope`提供相关的行为操作逻辑。与数据模型一样，添加后的行为逻辑可以在视图/模板中被调用。

<br>
#####**正确使用控制器**
控制器不应该包含太多的责任和义务，它只需负责一个单一视图所需的业务逻辑。  
一般的处理方式是将不属于控制器的逻辑封装到服务（`service`）中，然后在控制器中通过依赖注入调用相关服务。  
下面场合不适用控制器：
- 任何形式的`DOM`操作：控制器只应该包含业务逻辑。`DOM`操作则属于应用程序的表现层逻辑操作。把任何表现层的逻辑放到控制器中将会大大增加业务逻辑的测试难度。`ng`提供数据绑来实现自动化的`DOM`操作。如果需要手动进行`DOM`操作，那么最好将表现层的逻辑封装在 指令 中
- 格式化输入：使用 `angular`表单控件 代替
- 过滤输出：使用` angular`过滤器 代替
- 在控制器间复用有状态或无状态的代码：使用`angular`服务 代替
- 管理其它部件的生命周期（如手动创建` service` 实例）



<br><br>
>**`NOTE:`**  
简单地讲，控制器划分出一块作用域，即数据模型。并在数据模型中添加属性或定义一些逻辑行为以增强作用域。在模板中通过指令使用控制器，从而该模板块中可以调用该控制器中的数据模型（属性或方法）。  从这个角度来说，控制器在数据模型和视图的交互中起着桥梁作用。

>模板块下的元素还可以通过指令引用其它控制器,如下：

```
<div ng-controller="MainCtrl">
    <div ng-controller="ChildCtrl">
        <div ng-controller="GrandChildCtrl">
        ....
        </div>
    </div>
</div>
```

>每个控制器都包含一个子作用域，然后作用域基于原型链的工作机制，即子作用域可回溯访问父级作用域的属性或行为，而该子作用域的属性或方法则私有（假设该子作用域下没有其他控制器）。

>控制器专注于数据模型，对于非数据模型的操作应该封装到服务模块，控制器通过依赖注入（类似`CMD`中的`require`）来使用这些服务。